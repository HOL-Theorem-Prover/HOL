.PHONY: all

INCLUDES = $(HOLDIR)/tools/cmp

HOL = $(protect $(HOLDIR)/bin/hol.bare) --zero
# CMP = $(protect $(HOLDIR)/tools/cmp/cmp.exe)
CMP = diff

ifdef POLY
DEPS = test1.out test2.out test3.out test4.out

# FIXME: % in targets doesn't work
test1.out: test1.input test1.expected
	echo $(DEPS)
	$(HOL) < $< | tail -n +8 > $@
	$(CMP) $@ $(patsubst %.input,%.expected,$<)

test2.out: test2.input test2.expected
	$(HOL) < $< | tail -n +8 > $@
	$(CMP) $@ $(patsubst %.input,%.expected,$<)

test3.out: test3.input test3.expected
	$(HOL) < $< | tail -n +8 > $@
	$(CMP) $@ $(patsubst %.input,%.expected,$<)

test4.out: test4.input test4.expected
	$(HOL) < $< | tail -n +8 > $@
	$(CMP) $@ $(patsubst %.input,%.expected,$<)

endif

all: $(DEFAULT_TARGETS) $(DEPS)

EXTRA_CLEANS = $(wildcard *.out)
